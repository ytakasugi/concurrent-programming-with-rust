# concurrent-programming-with-rust

- [GitHub](https://github.com/oreilly-japan/conc_ytakano)

- clean

```text
cargo-clean-recursive
```

- Memory Ordering
  - Relaxed
    - メモリ順序は保証せず、アトミック性とメモリ順序の変更の一貫性だけを保証する
  - Aquire
    - メモリ順序付け命令より後続にあるメモリアクセス命令が、メモリ順序付け命令より前倒しになることを禁止する。
  - Release
    - メモリ順序付け命令に先行するメモリアクセス命令が、メモリ順序付け命令より後回しにされることを禁止する。
  - AcqRel
    - 読み取り部分をAcquire、書き込み部分をRelease として扱う
  - SeqCst
    - AcqRel に加えて、逐次一貫モデルに基づく順序を保証する
      - 逐次一貫モデル
        - 各スレッド内の操作（命令）は順序通りに実行されるものとみなされます。つまり、各スレッド内の操作は逐次的に実行され、その順序は変更されません。
        - 異なるスレッド間での操作の順序は一貫していると仮定されます。つまり、他のスレッドで発生した操作が、全てのスレッドに対して一貫して、一つの順序で現れるとみなされます。
  - happens-before
    - 以下を考えると、最初の操作と最後の操作に順序関係が保証される。これをhappens-beforeの関係という。ただし、ここでの「AcquireとRelease」の対応は、「ロック→アンロック」ではなく「アンロック→次のロック」の対応関係であることに注意が必要
      - (既にロックを取得している)スレッドAが、非アトミックな操作をする。
      - スレッドAが、ロックを解放する。 (Release書き込み)
      - スレッドBが、ロックを取得する。 (Acquire読み込み+Relaxed書き込み)
      - スレッドBが、非アトミックな操作をする。
  - fence
    - メモリアクセスの順序制御
      - プロセッサは、性能向上のためにメモリアクセスを再配置することがあります。これにより、プログラムの実行が速くなりますが、同時に意図しない順序のメモリアクセスが発生する可能性もあります。fence命令は、特定のポイントでメモリアクセスの順序を強制的に制御する手段を提供します。
    - 種類
      - Fence命令にはいくつかの種類があり、一般的なものには次のようなものがあります：
        - Load Fence
          - これは、以前のメモリ読み取り操作が後続の読み取り操作よりも前に完了することを保証します。
        - Store Fence
          - これは、以前のメモリ書き込み操作が後続の書き込み操作よりも前に完了することを保証します。
        - Full Fence
          - これは、読み取りと書き込みの両方に対する順序を制御します。
  - sequenced before
    - 操作の順序関係
      - sequenced beforeは、2つの操作の順序関係を表現します。具体的には、操作Aが操作Bに対してsequenced before関係にある場合、操作Aは操作Bよりも前に発生したことを示します。
    - プログラム順序
      - sequenced beforeは、通常、プログラム内での操作の順序を参照します。プログラム順序とは、コード内の操作が記述された順序を指します。したがって、プログラム順序通りに実行される操作は、それぞれが前の操作に対してsequenced before関係にあります。
    - 競合の制御
      - sequenced beforeは、競合条件を制御するために使用されます。競合条件は、複数のスレッドやプロセスが同じデータやリソースに同時にアクセスし、予測不能な結果をもたらす可能性がある状況を指します。sequenced before関係を適切に設定することで、競合を適切に制御し、データの整合性を確保できます。
    - コンカレンシー制御
      - sequenced before関係は、コンカレンシー制御の手法やメモリモデルの基礎として使用されます。メモリバリアやロック、アトミック操作など、異なる同期手法を使用してsequenced before関係を設定することがあります。
  - synchronizes-with
    - 同期操作と非同期操作の関係:
      - synchronizes-withは、通常、同期操作と非同期操作との間の関係を指します。同期操作は、スレッドやプロセス間での情報の受け渡しや、メモリの同期を行う操作です。非同期操作は、同期操作以外の一般的な計算操作です。
    - 順序関係の確立:
      - synchronizes-withが成り立つと、前の操作が後続の操作に対して順序を確立することを意味します。これは、後続の操作が前の操作の影響を受けることを保証します。
    - 同期手段に依存:
      - synchronizes-with関係は、使用される同期手段に依存します。これは、ロック、セマフォ、メモリバリア、条件変数などの同期メカニズムを使用する際に重要です。同期手段を使用することで、特定の操作の順序を強制的に制御できます。
